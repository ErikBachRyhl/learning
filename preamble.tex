%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  ðŸ“š MATHEMATICS & PHYSICS NOTES PREAMBLE ðŸ“š      %
%  ====================================================== %
%  A comprehensive LaTeX setup for beautiful math notes   %
%  with colored theorem environments and lecture headers  %
%  ====================================================== %
%                                                         %
%  ðŸ“ USAGE INSTRUCTIONS:                                 %
%  â€¢ Put this file at: learning/preamble.tex             %
%  â€¢ In each topic folder, use: \input{../preamble.tex}  %
%  â€¢ Example: QFT/qft.tex â†’ \input{../preamble.tex}      %
%                                                         %
%  ðŸŽ¨ FEATURES:                                           %
%  â€¢ Beautiful colored theorem environments              %
%  â€¢ Lecture headers with date positioning               %
%  â€¢ Exercise numbering system                           %
%  â€¢ Custom math commands and symbols                    %
%  â€¢ âš¡ OPTIMIZED FOR FAST COMPILATION                    %
%    - Draft mode: \draftmodetrue (fast editing)         %
%    - Final mode: \draftmodefalse (full features)       %
%                                                         %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% ============================================================
% ðŸ”§ FUNDAMENTAL DOCUMENT SETUP
% ============================================================
% Basic LaTeX configuration and page layout

\usepackage[T1]{fontenc}                                    % Better font encoding
\usepackage[utf8]{inputenc}                                % UTF-8 input support
\usepackage{lmodern}                                        % High-quality Latin Modern fonts
\usepackage[a4paper,margin=2.5cm,twoside]{geometry}        % Page layout (twoside for headers)
\setlength{\headheight}{13.6pt}                            % Fix fancyhdr warning
\usepackage{microtype}                                     % Micro-typography improvements
\usepackage{tikz}                                          % For diagrams and lecture headers
\usetikzlibrary{calc}                                      % TikZ calculations

\usepackage{dsfont} % For identity symbol in math

% ============================================================
% âš¡ DRAFT MODE FOR FAST COMPILATION
% ============================================================
% DRAFT MODE: Set \draftmodetrue for fast compilation during editing
%            Set \draftmodefalse for final PDF with all features enabled
% This disables expensive features like full hyperref, tikz overlays, and image loading
\newif\ifdraftmode
\draftmodetrue                                               % âš¡ FAST MODE: Disables expensive features

% ============================================================
% ðŸ“ MATHEMATICS & PHYSICS PACKAGES
% ============================================================
% Essential packages for mathematical typesetting

\usepackage{amsmath,amssymb,amsthm}                         % AMS mathematical environments
\usepackage{mathtools}                                      % Enhanced amsmath with fixes
\usepackage{xparse}                                         % For \IfBlankTF command
\usepackage{physics}                                        % Physics notation: \dv, \pdv, \grad, etc.
\usepackage{siunitx}                                        % Units: \SI{9.81}{\metre\per\squared\second}
\sisetup{per-mode=symbol}                                   % Use symbols for units (m/s not m s^{-1})

% ============================================================
% ðŸ“‹ THEOREM-LIKE ENVIRONMENTS
% ============================================================
% Standard theorem environments (numbered by section)

\theoremstyle{definition}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{corollary}[theorem]{Corollary}

% Manual theorem environments (for custom numbering)
% Usage: \begin{mtheorem}[Custom Name]{content}\end{mtheorem}

\newtheorem{manualtheoreminner}{Theorem}
\newenvironment{mtheorem}[1]{%
  \IfBlankTF{#1}
    {\renewcommand{\themanualtheoreminner}{\unskip}}
    {\renewcommand\themanualtheoreminner{#1}}%
  \manualtheoreminner
}{\endmanualtheoreminner}

\newtheorem{manuallemmainner}{Lemma}
\newenvironment{mlemma}[1]{%
  \IfBlankTF{#1}
    {\renewcommand{\themanuallemmainner}{\unskip}}
    {\renewcommand\themanuallemmainner{#1}}%
  \manuallemmainner
}{\endmanuallemmainner}

\newtheorem{manualpropinner}{Proposition}
\newenvironment{mprop}[1]{%
  \IfBlankTF{#1}
    {\renewcommand{\themanualpropinner}{\unskip}}
    {\renewcommand{\themanualpropinner}{#1}}%
  \manualpropinner
}{\endmanualpropinner}

\newtheorem{manualcorollaryinner}{Corollary}
\newenvironment{mcorollary}[1]{%
  \IfBlankTF{#1}
    {\renewcommand{\themanualcorollaryinner}{\unskip}}
    {\renewcommand\themanualcorollaryinner{#1}}%
  \manualcorollaryinner
}{\endmanualcorollaryinner}

% Problem and exercise environments
\newtheorem{manualprobleminner}{Problem â€“}
\newenvironment{problem}[1]{%
  \IfBlankTF{#1}
    {\renewcommand{\themanualprobleminner}{\unskip}}
    {\renewcommand\themanualprobleminner{#1}}%
  \manualprobleminner
}{\endmanualprobleminner}

\newtheorem{manualexerciseinner}{Exercise Result}
\newenvironment{exercise}[1]{%
  \IfBlankTF{#1}
    {\renewcommand{\themanualexerciseinner}{\unskip}}
    {\renewcommand\themanualexerciseinner{#1}}%
  \manualexerciseinner
}{\endmanualexerciseinner}

\newtheorem{manualmexerciseinner}{Exercise Result}
\newenvironment{mexercise}[1]{%
  \IfBlankTF{#1}
    {\renewcommand{\themanualmexerciseinner}{\unskip}}
    {\renewcommand\themanualmexerciseinner{#1}}%
  \manualmexerciseinner
}{\endmanualmexerciseinner}

\newtheorem{manualhomeworkinner}{Homework Result}
\newenvironment{mhomework}[1]{%
  \IfBlankTF{#1}
    {\renewcommand{\themanualhomeworkinner}{\unskip}}
    {\renewcommand\themanualhomeworkinner{#1}}%
  \manualhomeworkinner
}{\endmanualhomeworkinner}

% Definition and remark environments
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem*{definition*}{Definition}
\newtheorem*{idea}{Idea}

\theoremstyle{remark}
\newtheorem*{remark}{Remark}
\newtheorem*{note}{Note}
\newtheorem*{example}{Example}
\newtheorem*{intuition}{Intuition}
\newtheorem*{notation}{Notation}

\newtheorem{manualexampleinner}{Example}
\newenvironment{mexample}[1]{%
  \IfBlankTF{#1}
    {\renewcommand{\themanualexampleinner}{\unskip}}
    {\renewcommand\themanualexampleinner{#1}}%
  \manualexampleinner
}{\endmanualexampleinner}

% Equation numbering: (section.eq)
\numberwithin{equation}{section}

% Custom QED symbol
\newcommand{\qedst}{\hfill{$\bigstar$}}

% ============================================================
% ðŸŽ¨ COLORED THEOREM ENVIRONMENTS
% ============================================================
% Beautiful colored boxes for different types of content

% Only load the libraries we actually need (much faster than [most])
\usepackage{tcolorbox}
\tcbuselibrary{skins, breakable}

% Base tcolorbox settings
\tcbset{
  enhanced,
  breakable,
  boxrule=0.5pt,
  colback=white,
  arc=2pt,
  left=8pt,right=8pt,top=2pt,bottom=4pt,
  before skip=20pt, after skip=20pt,
  before upper={\setlength{\parskip}{0.6\baselineskip}\parindent=0pt\vspace{-0.3\baselineskip}}
}

% Color scheme definitions
\tcbset{
  myplain/.style={                    % For theorems, lemmas, propositions
    colback=orange!3,
    colframe=white,
    sharp corners,
    left=3mm,
    borderline west={3pt}{0pt}{orange!60}
  },
  myremark/.style={                   % For remarks and notes
    colback=blue!3,
    colframe=white,
    sharp corners,
    left=3mm,
    borderline west={3pt}{0pt}{blue!60}
  },
  mydefn/.style={                     % For definitions
    colback=teal!3,
    colframe=white,
    sharp corners,
    left=3mm,
    borderline west={3pt}{0pt}{teal!60}
  },
  mynote/.style={                     % For personal notes
    colback=purple!3,
    colframe=white,
    sharp corners,
    left=3mm,
    borderline west={3pt}{0pt}{purple!60}
  },
  myexample/.style={                  % For examples and problems
    colback=green!3,
    colframe=white,
    sharp corners,
    left=3mm,
    borderline west={3pt}{0pt}{green!60}
  },
}

% Apply colors to theorem environments
\tcolorboxenvironment{theorem}{myplain}
\tcolorboxenvironment{lemma}{myplain}
\tcolorboxenvironment{proposition}{myplain}
\tcolorboxenvironment{claim}{myplain}
\tcolorboxenvironment{corollary}{myplain}
\tcolorboxenvironment{mtheorem}{myplain}
\tcolorboxenvironment{mprop}{myplain}
\tcolorboxenvironment{mlemma}{myplain}
\tcolorboxenvironment{mcorollary}{myplain}
\tcolorboxenvironment{mexercise}{myplain}

\tcolorboxenvironment{problem}{myexample}
\tcolorboxenvironment{mhomework}{myexample}

\tcolorboxenvironment{definition}{mydefn}
\tcolorboxenvironment{definition*}{mydefn}
\tcolorboxenvironment{example}{myexample}
% \tcolorboxenvironment{intuition}{myexample}
\tcolorboxenvironment{mexample}{myexample}

\tcolorboxenvironment{remark}{myremark}
\tcolorboxenvironment{note}{mynote}

% ============================================================
% ðŸ“ LIST FORMATTING
% ============================================================
% Improved spacing for lists

\usepackage{enumitem}
\setlist[enumerate]{itemsep=2pt, topsep=4pt}
\setlist[itemize]{itemsep=2pt, topsep=4pt}

% ============================================================
% ðŸ–¼ï¸ GRAPHICS, TABLES & CODE
% ============================================================
% Packages for figures, tables, and code listings

% Graphics: TikZ already loads graphicx, so we only set options if needed
% Use \PassOptionsToPackage to set draft mode if in draft mode
\ifdraftmode
    \PassOptionsToPackage{draft}{graphicx}                 % Draft mode: skip image loading
\fi
\usepackage{graphicx}                                        % Graphics support (may already be loaded by TikZ)
\usepackage{subcaption}                                     % Subfigures
\usepackage{booktabs}                                       % Professional tables
\usepackage{tabularx}                                        % Extended tabular environment
\usepackage{listings}                                       % Code listings
\lstset{basicstyle=\ttfamily\small,breaklines=true}         % Code formatting

% ============================================================
% ðŸ”— HYPERLINKS & REFERENCES
% ============================================================
% Smart references and clickable links

\usepackage{xcolor}
\definecolor{myblue}{HTML}{0059B3}                          % Custom blue color

% Conditional hyperref loading (faster during editing)
\ifdraftmode
    % Draft mode: minimal hyperref (faster compilation)
    \usepackage[draft]{hyperref}
    \usepackage[nameinlink,capitalise]{cleveref}
\else
    % Final mode: full hyperref with links
    \usepackage[
        colorlinks,
        linkcolor=myblue,
        citecolor=myblue,
        urlcolor=myblue,
        pdfusetitle
    ]{hyperref}
    \usepackage[nameinlink,capitalise]{cleveref}
\fi
\crefname{equation}{}{}                                     % Empty equation references

% ============================================================
% ðŸ“š LECTURE NOTE STYLING
% ============================================================
% Special commands for organizing lecture notes

\usepackage{xifthen}
\usepackage{fancyhdr}
\usepackage{todonotes}

% Lecture command: \lecture{number}{date}{title}[material]
% Simple text-based design (no TikZ overhead - much faster!)
\def\@lecture{}%
\NewDocumentCommand{\lecture}{m m m o}{
    \ifthenelse{\isempty{#3}}{%
        \def\@lecture{Lecture #1}%
    }{%
        \def\@lecture{Lecture #1: #3}%
    }%
    \subsection{\@lecture}
    % Nice date formatting - appears right after the title
    \vspace{-0.8\baselineskip}%
    \noindent\hfill\textsf{#2}\par%
    \vspace{0.2\baselineskip}%
    \IfValueT{#4}{%
        \vspace{-0.5\baselineskip}%
        \noindent\textit{Reference Material:} #4.\par%
        \vspace{0.3\baselineskip}%
    }%
}

% Fancy headers and footers
\pagestyle{fancy}
\fancyhead[R]{\@lecture}                                    % Always on the right
\fancyhead[L]{}                                             % Empty left header
\fancyfoot[R]{\thepage}                                     % Page number on right
\fancyfoot[L]{}                                             % Empty left footer
\fancyfoot[C]{\leftmark}                                    % Center footer

% ============================================================
% ðŸŽ¨ TEXT COLORING COMMANDS
% ============================================================
% Quick color commands for emphasis

\newcommand{\textred}[1]{\textcolor{red}{#1}}
\definecolor{softgreen}{RGB}{34,139,34}                     % Forest green
\newcommand{\textgreen}[1]{\textcolor{softgreen}{#1}}
\newcommand{\textblue}[1]{\textcolor{blue}{#1}}

% ============================================================
% ðŸ”§ CUSTOM MATH COMMANDS
% ============================================================
% Personal mathematical notation shortcuts

\newcommand{\bb}[1]{\mathbb{#1}}                            % Blackboard bold: \bb{R}, \bb{C}
\DeclareMathOperator{\diag}{diag}                           % Diagonal operator

% ============================================================
% ðŸ“– TYPOGRAPHY SETTINGS
% ============================================================
% Document-wide typography preferences

\setlength{\parindent}{0pt}                                  % No paragraph indentation
\setlength{\parskip}{0.6\baselineskip}                      % Space between paragraphs

% ============================================================
% ðŸ“ NOTE-TO-SELF BOX
% ============================================================
% Special box for personal reminders

\usepackage{fontawesome}                                    % Icons for the note box

\newtcolorbox{selfnote}[1][]{
  breakable,
  enhanced,
  sharp corners,
  colback    = gray!8,
  colframe   = gray!70!black,
  borderline west = {3pt}{0pt}{gray!70!black},              % Left accent bar
  left=10pt, right=10pt, top=6pt, bottom=6pt,
  before skip=.8\baselineskip,
  after skip=.8\baselineskip,
  boxrule=.6pt,
  title={Note to self},
  fonttitle=\bfseries,
  #1                                                        % Allow local overrides
}

% ============================================================
% ðŸ§® ADVANCED MATHEMATICAL NOTATION
% ============================================================
% Additional mathematical symbols and commands

\DeclarePairedDelimiterX{\Set}[2]{\lbrace}{\rbrace}%        % Set notation: \Set{x}{condition}
  {\,#1 \,\,\delimsize\vert\,\, #2\,}

\newcommand{\quotient}[2]{#1 / \mathord{#2}}                % Quotient notation (used with hsnip "quo")

\usepackage{tikz-cd}                                        % Commutative diagrams
\usepackage[scr=rsfs]{mathalpha}                           % Script fonts

% ============================================================
% ðŸŽ¯ USAGE EXAMPLES
% ============================================================
% 
% BASIC THEOREMS:
% \begin{theorem}
%   This is a theorem.
% \end{theorem}
% 
% MANUAL NUMBERING:
% \begin{mtheorem}[Custom Name]
%   This theorem has a custom name.
% \end{mtheorem}
% 
% PROBLEMS:
% \begin{problem}{Zee I.8.3}
%   Problem statement here.
% \end{problem}
% 
% LECTURES:
% \lecture{1}{2024-01-15}{Introduction to QFT}
% 
% PERSONAL NOTES:
% \begin{selfnote}
%   Remember to check this later!
% \end{selfnote}
% 
% MATH NOTATION:
% \bb{R} for real numbers
% \Set{x}{x > 0} for sets
% \quotient{G}{H} for quotients
% 
% ============================================================